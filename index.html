<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>A-Frame Babia components</title>
    <meta name="description" content="Babia Bars example." />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-text-geometry-component@0.5.1/dist/aframe-text-geometry-component.min.js"></script>
    <script src="assets/aframe-babia-components.js"></script>

    <link rel="icon" href="/assets/logo.svg">
    <title>SEO-BirdLife</title>
    
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">
    <link src="assets/modify.js">
    <link src="assets/app.js">
</head>


<body>
    <a-scene background="color: #A8F3FF" id="AframeScene">
        <!-- ENVIROMENT -->
        <a-plane color="white" position="0 0 -10" rotation="-90 0 0" width="0.25" height="90"></a-plane>
        <a-sky color="lightblue"></a-sky>

        <a-camera position="1 0 20"></a-camera>
        <!-- Resto de tu escena aquí -->

        <!-- OCULUS CONTROLLERS -->
      <!--
      <a-entity id="cameraRig">
        <a-entity camera position="0 1.6 0">
          <a-text id="message" position="-1 2 -3" color="white" align="center" value=""></a-text>
        </a-entity>
        <a-entity oculus-touch-controls="hand: left"
                  collider-check raycaster="objects: .collidable; showLine: true"
                  thumbstick-logging></a-entity>
        <a-entity oculus-touch-controls="hand: right"
                  collider-check raycaster="objects: .collidable; showLine: true"
                  thumbstick-logging></a-entity>
      </a-entity> -->

        <!-- Aquí vamos a añadir las barras desde la API -->
        <a-entity id="bar-container" position="0 0 0" rotation="0 0 0"></a-entity>
        <a-entity text="value: 2013; align: right; width: 10; color: #511845" position="0 8.74318 4.48508" rotation="" animation="property: text.opacity; to: 1; dur: 2000"></a-entity>
    </a-scene>

    <script id="fw-bars">
        // Realizar una solicitud HTTP para obtener los datos de la API
        var requestOptions = {
          method: 'GET',
          redirect: 'follow'
        };

        fetch("https://seobirdlife.coderf5.es/seguidores/rrss/apis", requestOptions)
            .then(response => response.json())
            .then(data => {
                // Obtener la referencia al contenedor de las barras
                const barContainer = document.querySelector('#bar-container');

                // Crear el atributo data para babia-bars usando los datos de la API
                const babiaBarsData = data.map(item => {
                    return {
                        x_axis: item.fkYear.year.toString(), // Convertir el año a cadena
                        height: item.cantidad,
                        rotation: "0 0 0",
                        tooltip: `Año: ${item.fkYear.year}\nCantidad: ${item.cantidad}`
                    };
                });

                // Crear la entidad babia-bars con el atributo data actualizado
                const babiaBarsEntity = document.createElement('a-entity');
                babiaBarsEntity.setAttribute('babia-bars', {
                    legend: true,
                    axis: true,
                    palette: "ubuntu",
                    titleColor: "#FFFFFF",
                    titleFont: "#optimerBoldFont",
                    titleRotation: "0 0 0",
                    heightMax: 20,
                    animation: true,
                    data: babiaBarsData // Usar los datos actualizados
                });

                // Agregar la entidad babia-bars al contenedor
                barContainer.appendChild(babiaBarsEntity);
            })
            .catch(error => {
                console.error('Error al obtener los datos:', error);
            });
    </script>
</body>
</html>
